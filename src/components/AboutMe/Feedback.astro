---
import { Icon } from "astro-icon/components";
import type { CollectionEntry } from "astro:content";
import { getEntry, render } from "astro:content";

interface Props {
    entry: CollectionEntry<"feedbacks">;
}

const { entry }: Props = Astro.props;
const data = entry.data;

const { Content } = await render(entry);
---

<div class="flex gap-3">
    <Icon class="toggleFeedback text-dimmed -rotate-90 w-[54px] h-[54px]" name={"chevronDown"} />
    <div class="toggleFeedback w-full relative -top-2">
        <div class="flex justify-between">
            <!-- Person name -->
            <h4 class="text-light tracking-tight">{data.fromName}</h4>
            <!-- Feedback stars -->
            <div class="flex gap-3">
                {
                    () => {
                        const stars = new Array(data.stars).fill(null);
                        const emptyStars = new Array(5 - data.stars).fill(null);
                        const starClass = "w-[32px] h-[32px]";
                        return (
                            <>
                                {stars.map(() => (
                                    <Icon name={"star"} class={`${starClass} text-accent opacity-80`} />
                                ))}
                                {emptyStars.map(() => (
                                    <Icon name={"star"} class={`${starClass} text-dimmed opacity-15`} />
                                ))}
                            </>
                        );
                    }
                }
            </div>
        </div>
        <!-- Feedback -->
        <div class="feedback-container text-gradient title-gradient-left">
            <Content />
        </div>
    </div>
</div>

<style>
    h4 {
        font-size: var(--text-sm);
    }

    .feedback-container {
        font-size: var(--text-sm);
    }

    .feedback-container-open {
    }
</style>

<script>
    const toggles = document.querySelectorAll(".toggleFeedback");
    toggles.forEach((toggle) => {
        toggle.addEventListener("click", () => {
            // Toggle open
            const container = document.querySelector(".feedback-container");
            if (container) {
                container.classList.toggle("line-clamp-1");
            }
        });
    });
</script>
